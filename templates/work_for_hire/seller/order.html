{% extends 'work_for_hire/seller/base.html' %}
{% block navbar %}
    <style>
    body{
        font-weight: 600 !important;
    }
    .create_s{
        display: none !important;
    }
    a{
        color: black !important;
        font-weight: 700;
        font-family: "Elsie";
        font-size: 1.5rem;
    }
</style>
    {% if o %}
            <div class="container" style="width: 30rem">
                <ul class="text-center" style="list-style-type:none;">
                    <li>
                        <div class="jumbotron">
                        {% for o in o %}
                            {% if user.username == o.seller  %}
                                <a class="order_id" href="{% url 'purchase_services' srv_pk=o.id %}">Order Of {{ o.order_title }}</a>
                            {% else %}
                                <a class="order_id" href="{% url 'purchase_services' srv_pk=o.id %}">Order Of {{ o.order_title }}</a>
                            {% endif %}<br><br>
                        {% endfor %}
                        </div>
                    </li>
                </ul>
            </div>
    {% else %}
        {% if o_details %}
            <div class="order-container container text-center">
                <div class="title_show"><h1>{{ o_details.order_title }}</h1></div><br>
                <div class="user_show">User : {{ o_details.seller }}</div><br>
                <div class="pricing_show">Price : ${{ o_details.order_pricing }}</div><br>
                <div class="requirement_show">Requirement : {{ o_details.requirement }}</div><br>
                <div class="order_img_show"><img alt="" style="width:20%;" src="{{ o_details.requirement_assets.url }}"/></div><br>
                {% if o_details.delivery == 1 %}
                    <b>Delivered</b>
                {% else %}
                    <button type="submit" class="btn btn-outline-primary deliver_btn"><a class="" href="{% url 'delivery' o_pk=o_details.id %}">Deliver</a></button>
                {% endif %}
                <br>
                <div class="container">
                    <div class="receive-container text-left" style="width:100%"></div><br><br>
                    <div class="text-center">
                        <input type="text" id="chat_field"/>
                        <button id="send_btn" class="btn btn-outline-primary">Send</button>
                    </div>
                </div>
            </div>
            <script>
            $('#send_btn').click(function (e) {
                e.preventDefault();
                $.ajax({
                    url: '{% url 'chatting' order_id=o_details.id %}',
                    type: 'POST',
                    data:{
                       text: $('#chat_field').val(),
                       csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                    },
                    success: function (data) {
                        $('#chat_field').val('');
                        {#let chat = JSON.parse(data);#}
                        {#$('.receive-container').append('<div>' + chat["fields"]["text"] + '<div class="text-right" style="font-size:0.9em">' + chat["fields"]["created_by"] + '</div></div><hr>');#}
                        $('.receive-container').append('<div>' + data + '<div class="text-right" style="font-size:0.9em">now</div></div><hr>');

                    }
                });
            });
                $.ajax({
                    url: '{% url 'chatting' order_id=o_details.id %}',
                    success: function (data) {
                        let chat = JSON.parse(data);
                        console.log(chat);
                        let i = 0;
                        while(i < chat.length){
                            $('.receive-container').append('<div>' + chat[i]["fields"]["text"] + '<div class="text-right" style="font-size:0.9em">' + chat[i]["fields"]["created_by"] + '</div></div><hr>');
                            i = i+1;
                        }
                    }
                });

            </script>
            {% else %}
            <div class="jumbotron text-center"><h1>Currently, You Don't Have Any Orders !!!</h1></div>
        {% endif %}
    {% endif %}

{% endblock %}













